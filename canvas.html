<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <title>HMM Logos</title>
    <style>
      .clearfix img {
        position:absolute;
        border:none;
        top:0;
        left:0;
        display:none;
      }
      .clearfix {
        position:relative;
      }
      canvas {
        border: 1px solid #999;
        height: 300px;
      }
    </style>
    <script>

      var context = null;

      $.fn.hmm_logo = function(data) {
        var column_width = 34;
        var vis_width   = $(this).width();
        var x = 0;
        var y = 285;
        var column_num = 1;
        var colors = {
          'A': '#cbf751',
          'C': '#5ec0cc',
          'G': '#ffdf59',
          'T': '#b51f16',
          'U': '#b51f16'
        };

        var columns = [
          ['A:0.25','G:0.25','C:0.25','T:0.25'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:1'],
          ['C:0.5','G:0.5','A:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['C:0.1','G:0.4','A:0.1','T:0.01'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['A:0.1','G:0.4','C:0.1','T:0.01'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['G:0.2','G:0.2','G:0.2','G:0.2','G:0.2'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:1','C:0','T:0'],
          ['A:0','G:0.9','C:0','T:0'],
          ['A:0','G:0.8','C:0','T:0'],
          ['A:0','G:0.7','C:0','T:0'],
          ['A:0','G:0.6','C:0','T:0'],
          ['A:0','G:0.5','C:0','T:0'],
          ['A:0','G:0.4','C:0','T:0'],
          ['A:0','G:0.3','C:0','T:0'],
          ['A:0','G:0.2','C:0','T:0'],
          ['A:0','G:0.1','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0.6','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.1','G:0.4','C:0.1','T:0.01'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['G:0.2','G:0.2','G:0.2','G:0.2','G:0.2'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:1','C:0','T:0'],
          ['A:0','G:0.9','C:0','T:0'],
          ['A:0','G:0.8','C:0','T:0'],
          ['A:0','G:0.7','C:0','T:0'],
          ['A:0','G:0.6','C:0','T:0'],
          ['A:0','G:0.5','C:0','T:0'],
          ['A:0','G:0.4','C:0','T:0'],
          ['A:0','G:0.3','C:0','T:0'],
          ['A:0','G:0.2','C:0','T:0'],
          ['A:0','G:0.1','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0.6','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.1','G:0.4','C:0.1','T:0.01'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['G:0.2','G:0.2','G:0.2','G:0.2','G:0.2'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:1','C:0','T:0'],
          ['A:0','G:0.9','C:0','T:0'],
          ['A:0','G:0.8','C:0','T:0'],
          ['A:0','G:0.7','C:0','T:0'],
          ['A:0','G:0.6','C:0','T:0'],
          ['A:0','G:0.5','C:0','T:0'],
          ['A:0','G:0.4','C:0','T:0'],
          ['A:0','G:0.3','C:0','T:0'],
          ['A:0','G:0.2','C:0','T:0'],
          ['A:0','G:0.1','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0.6','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.1','G:0.4','C:0.1','T:0.01'],
          ['A:0.6','G:0.02','C:0.03','T:0.04'],
          ['A:0.01','G:0.7','C:0.2','T:0.01'],
          ['A:0.01','G:0.01','C:0.02','T:0.01'],
          ['G:0.2','G:0.2','G:0.2','G:0.2','G:0.2'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:1','C:0','T:0'],
          ['A:0','G:0.9','C:0','T:0'],
          ['A:0','G:0.8','C:0','T:0'],
          ['A:0','G:0.7','C:0','T:0'],
          ['A:0','G:0.6','C:0','T:0'],
          ['A:0','G:0.5','C:0','T:0'],
          ['A:0','G:0.4','C:0','T:0'],
          ['A:0','G:0.3','C:0','T:0'],
          ['A:0','G:0.2','C:0','T:0'],
          ['A:0','G:0.1','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0.6','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0'],
          ['A:0.9','G:0','C:0','T:0'],
          ['A:0.8','G:0','C:0','T:0'],
          ['A:0.7','G:0','C:0','T:0'],
          ['A:0.6','G:0','C:0','T:0'],
          ['A:0.5','G:0','C:0','T:0'],
          ['A:0.4','G:0','C:0','T:0'],
          ['A:0.3','G:0','C:0','T:0'],
          ['A:0.2','G:0','C:0','T:0'],
          ['A:0.1','G:0','C:0','T:0'],
          ['A:0','G:0','C:0','T:0']
        ];
        /*var columns = [
          ['A:0.25','G:0.25','C:0.25','T:0.25'],
          ['A:1','G:0','C:0','T:0'],
          ['A:0.25','G:0','C:0','T:0'],
          ['A:1','G:0','C:0','T:0']
        ];*/
        var image_width = columns.length * column_width;

        // create the canvas here.
        $(this).append('<canvas id="canv" height="300" width="'+ image_width + '"></canvas>');

        var canvas = $(this).find('#canv')[0];
        context = canvas.getContext("2d");

        for (var i = 0; i < 2; i++) {
          context.beginPath();
          context.moveTo(0, y);
          context.lineTo(image_width, y);
          context.lineWidth = 1;
          context.strokeStyle = "#999999";
          context.stroke();
          y = y - 15;
        }


        y = y - 40;


        console.time('columns');
        var max_cols = columns.length;

        // loop for each column
        for ( var i = 0; i < max_cols; i++ ) {
          var column = columns[i];
          var previous_height = 0;
          var letters = column.length;
          // draw each value in the column
          for ( var j = 0; j < letters; j++ ) {
            var letter = column[j];
            var values = letter.split(':', 2);
            if (values[1] > 0.1) {
              var start = x + (column_width / 2);

              var y_pos = 269 - previous_height;

              var x_pos = x + (column_width / 2);

              var glyph_height = 252 * values[1];

              context.font = "bold 350px Arial";
              context.textAlign = "center";
              context.fillStyle = colors[values[0]];
              context.transform (0.12, 0, 0, values[1], x_pos, y_pos);
              context.fillText(values[0], 0, 0);
              context.setTransform (1, 0, 0, 1, 0, 0);
              previous_height = previous_height + glyph_height;

            }
          }

          // draw top ticks
          context.beginPath();
          context.moveTo(x, 0);
          context.lineTo(x, 5);
          context.strokeStyle = "#999";
          context.stroke();

          // draw insert probability ticks
          context.beginPath();
          context.moveTo(x, 285);
          context.lineTo(x, 290);
          context.strokeStyle = "#999";
          context.stroke();

          // draw insert length ticks
          context.beginPath();
          context.moveTo(x, 270);
          context.lineTo(x, 275);
          context.strokeStyle = "#999";
          context.stroke();

          // draw column divider lines
          context.beginPath();
          context.moveTo(x, 270);
          context.lineTo(x, 0);
          context.strokeStyle = "#ddd";
          context.stroke();

          // draw column numbers
          context.font = "10px Arial";
          context.textAlign = "center";
          context.fillStyle = "#666";
          context.fillText(column_num, x + (column_width / 2), 10);

          //draw insert odds
          var odds = (Math.random() * 1).toFixed(2);
          var odds_fill = '#ddd';
          if (odds > 0.6) {
            odds_fill = '#333';
          }

          context.font = "10px Arial";
          context.textAlign = "center";
          context.fillStyle = odds_fill;
          context.fillText(odds, x + (column_width / 2), 270 + 10);

          // draw insert length
          context.font = "10px Arial";
          context.textAlign = "center";
          context.fillStyle = "#666";
          context.fillText(parseInt(Math.random() * 100), x + (column_width / 2), 285 + 10);

          // increment for the next column
          column_num++;
          x = x + column_width;
        }

        console.timeEnd('columns');

        /*  
        var max = image_width - vis_width;
        var sliding = false;
        var slide_x = 0;
        var slider = paper.rect(0, 0, image_width, 300)
          .attr({'fill':'#ff0000', 'opacity':0.5})
          .mousemove(function(e) {
            e.stopPropagation();
            e.preventDefault();
            if (sliding) {
              var moved = slide_x - e.pageX
              var x = paper._viewBox[0] + moved;

              console.log(moved, slide_x +' - ' + e.pageX, max + ' | ' + x);
              if (x < 0) {
                x = 0;
              }
              else if (x > max) {
                x = max;
              }
              paper.setViewBox(x, 0, vis_width, vis_height);
            }
          })
          .mousedown(function(e) {
            e.stopPropagation();
            e.preventDefault();
            sliding = true;
            slide_x = e.pageX;
          })
          .mouseup(function(e) {
            e.stopPropagation();
            e.preventDefault();
            sliding = false;
            slide_x = 0;
          })
          .mouseout(function(e) {
            e.stopPropagation();
            e.preventDefault();
            sliding = false;
            slide_x = 0;
          });
        */

      }


      $(document).ready(function() {
        $('#graphic').hmm_logo();
      });
    </script>
  </head>
  <body>
    <div id="graphic"></div>
  </body>
</html>
